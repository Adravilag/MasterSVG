<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src ${cspSource} 'unsafe-inline'; script-src 'nonce-${nonce}'; img-src ${cspSource} https: data:; font-src ${cspSource};">
  <title>${i18n_title}</title>
  <style>${css}</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <input type="text" class="search-input" id="searchInput" placeholder="${i18n_searchPlaceholder}">
      <button id="codePreviewBtn" class="icon-btn" title="Preview de código" onclick="openCodePreview()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z"/><circle cx="12" cy="12" r="3"/></svg>
      </button>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="workspace">${i18n_workspace}</button>
      <button class="tab" data-tab="library">${i18n_library}</button>
      <button class="tab" data-tab="online">${i18n_online}</button>
    </div>

    <div class="content" id="content">
      <div class="loading">
        <div class="spinner"></div>
      </div>
    </div>

    <div class="build-advanced-options">
      <div class="option-row">
        <span class="option-label">Formato de salida</span>
        <div class="format-select">
          <button class="format-btn active" data-format="icons.js" onclick="setBuildFormat('icons.js')">JS/TS</button>
          <button class="format-btn" data-format="transform" onclick="setBuildFormat('transform')">Transform</button>
          <button class="format-btn" data-format="sprite.svg" onclick="setBuildFormat('sprite.svg')">Sprite</button>
          <button class="format-btn" data-format="css" onclick="setBuildFormat('css')">CSS</button>
        </div>
      </div>

      <div id="dynamicOptions"></div>
    </div>

    <div class="watch-row">
      <label class="watch-toggle">
        <input type="checkbox" id="watchModeToggle" />
        <span>Watch Mode</span>
      </label>
      <div id="watchStatus" class="watch-status">
        </div>
      <button class="flush-btn" onclick="forceSync()">Sync Now</button>
    </div>

    <div id="codePreviewModal" class="modal">
      <div class="modal-backdrop" onclick="closeCodePreview()"></div>
      <div class="modal-panel">
        <div class="modal-header">
          <div class="modal-title">Code Studio Preview</div>
          <button class="modal-close" onclick="closeCodePreview()">✕</button>
        </div>
        <div class="modal-body">
          <div class="code-preview-container">
            <div class="code-preview-header">
              <span id="codePreviewLang">TSX</span>
              <span style="opacity:0.5">READ-ONLY</span>
            </div>
            <pre id="codePreviewBody" class="code-preview-body"></pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script nonce="${nonce}">
    ${js}
  </script>
</body>
</html>
